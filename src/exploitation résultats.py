import matplotlib.pyplot as plt
import numpy as np
from scipy.interpolate import spline

def lecture_fichier():
    resultats = open("resultats130.txt","r")
    le=resultats.read()
    be = le.split('\n')
    a,b,c=be[0],be[1],be[2]
    ap=a.split(';')
    bp=b.split('//')
    cp=c.split('//')
    res0=[]
    res1=[]
    res2=[]
    for i in range(len(ap)-1):
        res0.append(float(ap[i]))
    for i in range(len(bp)-1):
        x=bp[i].split(';')
        res1.append([])
        for j in range(len(x)-1):
            res1[i].append(float(x[j]))
    for i in range(len(bp)-1):
        x=cp[i].split(';')
        res2.append([])
        for j in range(len(x)-1):
            res2[i].append(float(x[j]))
    resultats.close()
    
    return res0, res1, res2

lflx, resflx, resvit = lecture_fichier()

#resvit=[]
#
# for j in range(len(resvit1)):
#     resvit.append([])
#     for i in resvit1[j]:
#         if i%5>=2.5:
#             resvit[j].append((i//5+1)*5)
#         else:
#             resvit[j].append((i//5)*5)
count=0
count1=0

for i in range(len(resvit)):
    for j in range(1,len(resvit[i])):
        if resvit[i][j]>resvit[i][j-1]:
            resvit[i][j]=(resvit[i][j-1]-0.2)
            count+=1
        if resflx[i][j]<resflx[i][j-1]:
            resflx[i][j]=(resflx[i][j-1]+5)
            count1+=1

print(count,count1,len(resvit)*len(resvit[0]))

def double_points(x,y,z):
    resvit0=[]
    lflx0=[]
    resflx0=[]
    for i in range(len(x)-1):
        lflx0.append(x[i])
        lflx0.append((x[i]+x[i+1])/2)
    lflx0.append(x[-1])
    for i in range(len(y)):
        resvit0.append([])
        resflx0.append([])
        for j in range(len(y[0])-1):
            resvit0[i].append(y[i][j])
            resvit0[i].append((y[i][j]+y[i][j+1])/2)
            resflx0[i].append(z[i][j])
            resflx0[i].append((z[i][j]+z[i][j+1])/2)
        resvit0[i].append(y[i][-1])
        resflx0[i].append(z[i][-1])

    
    return lflx0, resvit0, resflx0


lflx0,resvit0,resflx0 = double_points(lflx,resvit,resflx)
lflx0,resvit0,resflx0 = double_points(lflx0,resvit0,resflx0)
lflx0,resvit0,resflx0 = double_points(lflx0,resvit0,resflx0)


resvits=[]
resflxs=[]

for i in range(len(resflx)):
    resvits.append([])
    resvits[i] = spline(lflx,resvit[i],lflx0)
    resflxs.append([])
    resflxs[i] = spline(lflx,resflx[i],lflx0)
    
# 
# plt.figure(4)
# for i in range(len(resflx)):
#     if i==0:
#         plt.plot(lflx0,resflxs[i], label = "1 voie")
#     else:
#         plt.plot(lflx0,resflxs[i], label = str(i+1)+" voies")
# plt.plot([i for i in range(5000)],[i for i in range(5000)], linestyle = '--', linewidth=2, label = 'y=x',c='black', )
# plt.xlabel("flux idéal")
# plt.ylabel("flux réel")
# plt.legend(loc = 0)
# plt.show()
# 
# """
# plt.figure(5)
# for i in range(len(resflx)):
#     if i==0:
#         plt.plot(resflxs[i],resvits[i], label = "1 voie")
#     else:
#         plt.plot(resflxs[i],resvits[i], label = str(i+1)+" voies")
# plt.xlabel("flux réel")
# plt.ylabel("vitesse moyenne")
# plt.legend()"""
# 
# plt.figure(5)
# for i in range(len(resflx)):
#     if i==0:
#         plt.plot(lflx0,resvits[i], label = "1 voie")
#     else:
#         plt.plot(lflx0,resvits[i], label = str(i+1)+" voies")
# plt.xlabel("flux idéal")
# plt.ylabel("vitesse moyenne")
# plt.legend()

plt.figure(1)
plt.plot(lflx0,resvits[1])

moy=0
for i in range(len(resflx)-1):
    print((resflx[i+1][-1]-resflx[i][-1]))
    moy+=(resflx[i+1][-1]-resflx[i][-1])
moy/=((len(resflx)-1))

